this is rewriten in cpp
